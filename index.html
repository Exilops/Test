<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ReciMe Lite</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://unpkg.com/htm@3.1.1/preact/standalone.mjs" type="module"></script>
  <style>
    :root{--primary:#f97316;--surface:#fff7ed}
    body{margin:0;font-family:system-ui;background:var(--surface);color:#1f2937}
    header{background:var(--primary);color:#fff;padding:1rem;font-size:1.25rem;font-weight:600}
    main{max-width:800px;margin:auto;padding:1rem}
    textarea,input{width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:.5rem;margin-bottom:.75rem}
    button{background:var(--primary);color:#fff;border:none;padding:.6rem 1.2rem;border-radius:.5rem}
    .card{background:#fff;border-radius:.75rem;padding:1rem;margin-top:1rem;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    .step{margin-bottom:.5rem}
    .ingredient{display:flex;gap:.5rem}
  </style>
</head>
<body>
  <header>AI Cooking Companion</header>
  <main id="app"></main>
  <script type="module">
    const { html, Component, render } = window.htmPreact;
    class App extends Component {
      state = { ing:'', diet:'', servings:2, loading:false, recipe:null, key:'' };
      generate = async () => {
        this.setState({ loading:true });
        const { ing, diet, servings, key } = this.state;
        if (!key) return alert('Add your OpenAI key in settings');
        const res = await fetch('https://api.openai.com/v1/chat/completions',{
          method:'POST',
          headers:{'Content-Type':'application/json','Authorization':`Bearer ${key}`},
          body:JSON.stringify({
            model:'gpt-4-turbo',
            temperature:0.3,
            messages:[
              {role:'system',content:'Return only valid JSON: title,total_time_min,servings,ingredients[{name,qty,unit}],steps[{text}],nutrition{kcal}'},
              {role:'user',content:`Create dinner for ${servings} using [${ing.split(',').map(s=>s.trim)}]${diet?` that is ${diet}`:''}, ready ‚â§40 min.`}
            ]
          })
        });
        const json = await res.json();
        try {
          this.setState({ recipe:JSON.parse(json.choices[0].message.content), loading:false });
        } catch(e){ alert('AI returned bad JSON'); this.setState({ loading:false }); }
      };
      render(_, { ing, diet, servings, loading, recipe, key }) {
        return html`
          <p>Type what you have, get a recipe.</p>
          <textarea rows="3" placeholder="e.g. chicken, zucchini, tomato" value=${ing} onInput=${e=>this.setState({ing:e.target.value})}></textarea>
          <input placeholder="Diet (optional)" value=${diet} onInput=${e=>this.setState({diet:e.target.value})} />
          <input type="number" min="1" max="12" value=${servings} onInput=${e=>this.setState({servings:e.target.value})} />
          <button onClick=${this.generate} disabled=${loading||!ing}>${loading?'Creating‚Ä¶':'Generate Recipe'}</button>
          ${recipe && html`
            <div class="card">
              <h2>${recipe.title}</h2>
              <div>‚è± ${recipe.total_time_min} min ¬∑ üçΩ ${recipe.servings} servings ¬∑ üî• ${recipe.nutrition?.kcal} kcal</div>
              <h3>Ingredients</h3>
              ${recipe.ingredients.map(i=>html`<div class="ingredient">${i.qty} ${i.unit} ${i.name}</div>`)}
              <h3>Steps</h3>
              ${recipe.steps.map((s,idx)=>html`<div class="step">${idx+1}. ${s.text}</div>`)}
            </div>
          `}
          <details style="margin-top:1rem">
            <summary>Settings</summary>
            <input placeholder="sk-xxxxxxxxxxxxxxxx" value=${key} onInput=${e=>this.setState({key:e.target.value})} />
          </details>
        `;
      }
    }
    render(html`<${App}/>`, document.getElementById('app'));
  </script>
</body>
</html>
